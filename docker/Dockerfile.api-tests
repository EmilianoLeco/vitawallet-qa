# Dockerfile para API Tests (Pytest + Newman)
FROM python:3.10-slim

# Instalar Node.js para Newman
RUN apt-get update && apt-get install -y \
    curl \
    && curl -fsSL https://deb.nodesource.com/setup_18.x | bash - \
    && apt-get install -y nodejs \
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/*

# Crear directorio de trabajo
WORKDIR /app

# Copiar archivos de dependencias
COPY requirements.txt package.json ./

# Instalar dependencias Python
RUN pip install --no-cache-dir -r requirements.txt

# Instalar dependencias Node.js (Newman)
RUN npm install --production

# Copiar c√≥digo fuente
COPY api-tests/ ./api-tests/
COPY pytest.ini ./

# Crear carpeta de reportes
RUN mkdir -p reports/pytest reports/newman

# Comando por defecto: ejecutar todos los tests
CMD ["pytest", "api-tests/pytest/", "-v", "--html=reports/pytest/api_report.html", "--self-contained-html"]
